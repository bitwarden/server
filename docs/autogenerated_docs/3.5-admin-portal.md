# Admin Portal

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [bitwarden_license/src/Sso/Views/Shared/_Layout.cshtml](https://github.com/bitwarden/server/blob/39f38f50/bitwarden_license/src/Sso/Views/Shared/_Layout.cshtml)
- [bitwarden_license/src/Sso/package-lock.json](https://github.com/bitwarden/server/blob/39f38f50/bitwarden_license/src/Sso/package-lock.json)
- [bitwarden_license/src/Sso/package.json](https://github.com/bitwarden/server/blob/39f38f50/bitwarden_license/src/Sso/package.json)
- [bitwarden_license/src/Sso/webpack.config.js](https://github.com/bitwarden/server/blob/39f38f50/bitwarden_license/src/Sso/webpack.config.js)
- [src/Admin/Controllers/ToolsController.cs](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs)
- [src/Admin/Models/StripeSubscriptionsModel.cs](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Models/StripeSubscriptionsModel.cs)
- [src/Admin/Sass/site.scss](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Sass/site.scss)
- [src/Admin/Sass/webfonts.scss](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Sass/webfonts.scss)
- [src/Admin/Views/Shared/_Layout.cshtml](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Shared/_Layout.cshtml)
- [src/Admin/Views/Tools/ChargeBraintree.cshtml](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Tools/ChargeBraintree.cshtml)
- [src/Admin/Views/Tools/StripeSubscriptions.cshtml](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Tools/StripeSubscriptions.cshtml)
- [src/Admin/package-lock.json](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/package-lock.json)
- [src/Admin/package.json](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/package.json)
- [src/Admin/webpack.config.js](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/webpack.config.js)
- [src/Core/MailTemplates/Mjml/package-lock.json](https://github.com/bitwarden/server/blob/39f38f50/src/Core/MailTemplates/Mjml/package-lock.json)
- [src/Core/Models/Stripe/StripeSubscriptionListOptions.cs](https://github.com/bitwarden/server/blob/39f38f50/src/Core/Models/Stripe/StripeSubscriptionListOptions.cs)

</details>



The Admin Portal is a web-based administrative interface for Bitwarden server administrators. It provides system management capabilities for users, organizations, providers, billing, and other administrative operations. This page documents the Admin Portal's architecture, code structure, and key features.

For information about the API service, see page [1.1].

## Overview

The Admin Portal is implemented as an ASP.NET Core MVC application. It is used by authorized administrators to:

- View and manage users and organizations
- Manage providers (cloud-hosted only)
- Perform billing and subscription operations
- Generate licenses and perform other system-level tasks

The Admin Portal is available in both cloud-hosted and self-hosted Bitwarden deployments. Some features are only available in cloud-hosted environments.

**Key code entry points:**

| Component         | File/Entity                                      |
|-------------------|--------------------------------------------------|
| Main entry point  | `src/Admin/Views/Shared/_Layout.cshtml`          |
| Build config      | `src/Admin/package.json`, `src/Admin/webpack.config.js` |
| Tools controller  | `src/Admin/Controllers/ToolsController.cs`       |

Sources:
- [src/Admin/Views/Shared/_Layout.cshtml:23-147](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Shared/_Layout.cshtml#L23-L147)
- [src/Admin/package.json:1-25](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/package.json#L1-L25)
- [src/Admin/Controllers/ToolsController.cs:18-61](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs#L18-L61)

## 2. Architecture

The Admin Portal is built on the Bitwarden Core library and follows the ASP.NET Core MVC pattern. It integrates with shared services and repositories to provide administrative features.

### 2.1. Code Structure and Component Mapping

**Component-to-Code Mapping Diagram**

```mermaid
graph TD
    subgraph "Admin Portal"
        "Views/Shared/_Layout.cshtml"["Views/Shared/_Layout.cshtml"]
        "Controllers/ToolsController.cs"["Controllers/ToolsController.cs"]
        "Models/StripeSubscriptionsModel.cs"["Models/StripeSubscriptionsModel.cs"]
        "Sass/site.scss"["Sass/site.scss"]
        "webpack.config.js"["webpack.config.js"]
    end

    subgraph "Core Services"
        "CoreLibrary"["Core Library"]
        "OrganizationService"["OrganizationService"]
        "UserService"["UserService"]
        "PaymentService"["PaymentService"]
        "ProviderService"["ProviderService"]
    end

    subgraph "Data Access"
        "Repositories"["Repositories"]
        "Database"["Database"]
    end

    "Controllers/ToolsController.cs" --> "CoreLibrary"
    "CoreLibrary" --> "OrganizationService"
    "CoreLibrary" --> "UserService"
    "CoreLibrary" --> "PaymentService"
    "CoreLibrary" --> "ProviderService"
    "CoreLibrary" --> "Repositories"
    "Repositories" --> "Database"
```

- **Controllers**: Handle HTTP requests and business logic (e.g., `ToolsController`)
- **Models**: Data structures for views and controller actions (e.g., `StripeSubscriptionsModel`)
- **Views**: Razor templates for UI rendering (e.g., `_Layout.cshtml`)
- **Sass/SCSS**: Stylesheets for UI (e.g., `site.scss`)
- **Webpack**: Asset bundling and frontend dependency management

Sources:
- [src/Admin/Controllers/ToolsController.cs:19-61](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs#L19-L61)
- [src/Admin/Sass/site.scss:1-64](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Sass/site.scss#L1-L64)
- [src/Admin/package.json:1-25](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/package.json#L1-L25)
- [src/Admin/webpack.config.js:1-64](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/webpack.config.js#L1-L64)

### 2.2. Authentication and Authorization

The Admin Portal uses ASP.NET Core Identity for authentication and a permission-based system for authorization. Access to each section and action is controlled by user permissions.

**Authorization Flow Diagram**

```mermaid
graph TD
    "LoginController"["LoginController"] --> "SignInManager"
    "SignInManager" --> "User"
    "User" --> "AccessControlService.UserHasPermission"
    "AccessControlService.UserHasPermission" --> "ControllerAction"
    "ControllerAction" --> "RequirePermissionAttribute"
```

- Authentication is handled by `SignInManager<IdentityUser>`.
- Authorization is enforced by checking permissions via `IAccessControlService.UserHasPermission`.
- Controller actions are decorated with `[RequirePermission(Permission.X)]` attributes.

Sources:
- [src/Admin/Views/Shared/_Layout.cshtml:3-22](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Shared/_Layout.cshtml#L3-L22)
- [src/Admin/Controllers/ToolsController.cs:63-137](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs#L63-L137)

## 3. User Interface

The Admin Portal UI is rendered using Razor views and Bootstrap-based styling. The navigation menu is dynamically generated based on user permissions and deployment type (cloud or self-hosted).

### 3.1. Navigation and Permissions

| Section        | Function                        | Permission Required                  | Self-Hosted Available |
|----------------|--------------------------------|--------------------------------------|----------------------|
| Users          | Manage users                    | `User_List_View`                     | Yes                  |
| Organizations  | Manage organizations           | `Org_List_View`                      | Yes                  |
| Providers      | Manage providers                | `Provider_List_View`                 | No                   |
| Tools          | Admin tools (see below)         | Various (`Tools_*`)                  | No                   |

**Tools menu options (cloud only, permission-gated):**
- Charge Braintree Customer (`Tools_ChargeBrainTreeCustomer`)
- Create Transaction (`Tools_CreateEditTransaction`)
- Promote Organization Admin (`Tools_PromoteAdmin`)
- Promote Provider Service User (`Tools_PromoteProviderServiceUser`)
- Generate License (`Tools_GenerateLicenseFile`)
- Manage Stripe Subscriptions (`Tools_ManageStripeSubscriptions`)
- Process Stripe Events (`Tools_ProcessStripeEvents`)
- Migrate Providers (`Tools_MigrateProviders`)

**Navigation Rendering Logic Diagram**

```mermaid
graph TD
    "User"["User"] --> "AccessControlService.UserHasPermission"
    "AccessControlService.UserHasPermission" --> "View Logic in _Layout.cshtml"
    "View Logic in _Layout.cshtml" --> "MenuItem:Users"
    "View Logic in _Layout.cshtml" --> "MenuItem:Organizations"
    "View Logic in _Layout.cshtml" --> "MenuItem:Providers"
    "View Logic in _Layout.cshtml" --> "MenuItem:Tools"
```

Sources:
- [src/Admin/Views/Shared/_Layout.cshtml:8-157](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Shared/_Layout.cshtml#L8-L157)

## 4. Core Functionality

### 4.1. Organization Management

Administrators can view and manage organizations, including details, settings, subscriptions, seats, storage, payment methods, and users.

**Organization Management Code Mapping**

```mermaid
graph TD
    "OrganizationsController"["OrganizationsController"] --> "OrganizationService"["OrganizationService"]
    "OrganizationService" --> "OrganizationRepository"["OrganizationRepository"]
    "OrganizationService" --> "PaymentService"["PaymentService"]
    "OrganizationService" --> "OrganizationUserRepository"["OrganizationUserRepository"]
```

Sources:
- [src/Core/AdminConsole/Services/Implementations/OrganizationService.cs:45-155](https://github.com/bitwarden/server/blob/39f38f50/src/Core/AdminConsole/Services/Implementations/OrganizationService.cs#L45-L155)

### 4.2. User Management

User management includes:

- Viewing user details
- Managing permissions and roles
- Resetting passwords
- Managing organization memberships

**User Management Code Mapping**

```mermaid
graph TD
    "UsersController"["UsersController"] --> "UserService"["UserService"]
    "UserService" --> "UserRepository"["UserRepository"]
    "OrganizationUsersController"["OrganizationUsersController"] --> "OrganizationUserService"["OrganizationUserService"]
    "OrganizationUserService" --> "OrganizationUserRepository"["OrganizationUserRepository"]
```

Sources:
- [src/Core/AdminConsole/Services/Implementations/OrganizationService.cs:45-155](https://github.com/bitwarden/server/blob/39f38f50/src/Core/AdminConsole/Services/Implementations/OrganizationService.cs#L45-L155)

### 4.3. Billing and Subscription Management

Billing and subscription management is available primarily in cloud-hosted environments. Features include:

- Charging customers (Braintree)
- Creating and editing transactions
- Managing Stripe subscriptions (search, export, bulk cancel)
- Generating licenses

**Billing Operations and Code Entities Diagram**

```mermaid
graph TD
    "ToolsController"["ToolsController.cs"] --> "PaymentService"["IPaymentService"]
    "ToolsController" --> "TransactionRepository"["ITransactionRepository"]
    "ToolsController" --> "StripeAdapter"["IStripeAdapter"]
    "ToolsController" --> "BraintreeGateway"["Braintree.BraintreeGateway"]
    "ToolsController" --> "GetCloudOrganizationLicenseQuery"["IGetCloudOrganizationLicenseQuery"]
    "ToolsController" --> "UserService"["IUserService"]
```

- `ToolsController` implements actions for each billing tool.
- Stripe subscription management uses `StripeSubscriptionsModel` and `StripeSubscriptionListOptions` for filtering and bulk operations.

Sources:
- [src/Admin/Controllers/ToolsController.cs:62-478](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs#L62-L478)
- [src/Admin/Models/StripeSubscriptionsModel.cs:1-45](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Models/StripeSubscriptionsModel.cs#L1-L45)
- [src/Core/Models/Stripe/StripeSubscriptionListOptions.cs:1-51](https://github.com/bitwarden/server/blob/39f38f50/src/Core/Models/Stripe/StripeSubscriptionListOptions.cs#L1-L51)
- [src/Admin/Views/Tools/ChargeBraintree.cshtml:1-45](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Tools/ChargeBraintree.cshtml#L1-L45)
- [src/Admin/Views/Tools/StripeSubscriptions.cshtml:1-268](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Tools/StripeSubscriptions.cshtml#L1-L268)

### 4.4. Provider Management

Provider management is available only in cloud-hosted environments. Features include:

- Viewing provider details
- Managing provider users and organizations
- Provider billing

**Provider Management Code Mapping**

```mermaid
graph TD
    "ProvidersController"["ProvidersController"] --> "ProviderService"["ProviderService"]
    "ProviderService" --> "ProviderRepository"["ProviderRepository"]
```

Sources:
- [src/Admin/Views/Shared/_Layout.cshtml:62-67](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Shared/_Layout.cshtml#L62-L67)

### 4.5. Tool Operations

Administrative tools include:

- License generation (organization/user)
- Promotion of users to organization admin or provider service user
- Processing Stripe events
- Provider migration

These are implemented as actions in `ToolsController` and are permission-gated.

Sources:
- [src/Admin/Controllers/ToolsController.cs:166-478](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs#L166-L478)
- [src/Admin/Views/Shared/_Layout.cshtml:68-128](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Shared/_Layout.cshtml#L68-L128)

## 5. Security Considerations

Security features in the Admin Portal:

- **Authentication**: ASP.NET Core Identity
- **Authorization**: Permission-based checks via `RequirePermission` attributes
- **CSRF Protection**: Anti-forgery tokens in forms
- **HTTPS**: All admin traffic must be over HTTPS
- **Activity Logging**: Administrative actions are logged

Sources:
- [src/Admin/Controllers/ToolsController.cs:63-72](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs#L63-L72)
- [src/Admin/Views/Shared/_Layout.cshtml:137-146](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Shared/_Layout.cshtml#L137-L146)
- [src/Admin/Views/Tools/ChargeBraintree.cshtml:8-15](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Views/Tools/ChargeBraintree.cshtml#L8-L15)

## 6. Technical Implementation

### 6.1. Frontend Technologies

The Admin Portal frontend stack:

- Bootstrap 5 for UI components
- SCSS (compiled to CSS) for styling
- jQuery for DOM manipulation
- Toastr for notifications
- Webpack for asset bundling

**Frontend Build and Dependency Diagram**

```mermaid
graph TD
    "site.scss"["Sass/site.scss"] --> "Webpack"
    "site.js"["JavaScript"] --> "Webpack"
    "Webpack" --> "wwwroot/assets/site.css"
    "Webpack" --> "wwwroot/assets/site.js"
    "wwwroot/assets/site.css" --> "RazorViews"
    "wwwroot/assets/site.js" --> "RazorViews"
    "Bootstrap"["bootstrap"] --> "Webpack"
    "jQuery"["jquery"] --> "Webpack"
    "FontAwesome"["font-awesome"] --> "Webpack"
    "Toastr"["toastr"] --> "Webpack"
```

Sources:
- [src/Admin/package.json:10-15](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/package.json#L10-L15)
- [src/Admin/Sass/site.scss:1-64](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Sass/site.scss#L1-L64)
- [src/Admin/webpack.config.js:1-64](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/webpack.config.js#L1-L64)

### 6.2. Backend Implementation

The backend uses:

- ASP.NET Core MVC
- Dependency injection for services
- Repository pattern for data access
- Service pattern for business logic

**Request Handling Flow**

```mermaid
graph TD
    "HTTP Request" --> "Controller"
    "Controller" --> "Service Layer"
    "Service Layer" --> "Repository Layer"
    "Repository Layer" --> "Database"
    "Controller" --> "View"
    "View" --> "HTTP Response"
```

Sources:
- [src/Admin/Controllers/ToolsController.cs:17-61](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs#L17-L61)

## 7. Configuration

Configuration is managed via `appsettings.json` and environment variables. Key options:

- Database connection strings
- Authentication and identity settings
- Feature flags
- Payment processor (Braintree, Stripe) settings

Self-hosted deployments allow full configuration; cloud-hosted deployments are managed by Bitwarden Inc.

Sources:
- [src/Admin/Controllers/ToolsController.cs:18-61](https://github.com/bitwarden/server/blob/39f38f50/src/Admin/Controllers/ToolsController.cs#L18-L61)

## 8. Summary

The Admin Portal is a critical component of the Bitwarden server architecture, providing administrative tools for managing users, organizations, providers, and system operations. It's designed to be used by system administrators in both cloud-hosted and self-hosted environments, with certain features exclusive to cloud-hosted deployments.